# http://www.cvedetails.com/cve/CVE-2012-3368/

--- attach.c.orig	2008-01-31 03:59:54.000000000 -0200
+++ attach.c	2016-03-24 22:03:43.000000000 -0300
@@ -237,12 +237,16 @@
 		/* stdin activity */
 		if (n > 0 && FD_ISSET(0, &readfds))
 		{
+			ssize_t l;
+
 			pkt.type = MSG_PUSH;
 			memset(pkt.u.buf, 0, sizeof(pkt.u.buf));
-			pkt.len = read(0, pkt.u.buf, sizeof(pkt.u.buf));
+			l = read(0, pkt.u.buf, sizeof(pkt.u.buf));
 
-			if (pkt.len <= 0)
+			if (l <= 0)
 				exit(1);
+
+			pkt.len = l;
 			process_kbd(s, &pkt);
 			n--;
 		}
